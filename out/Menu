os.loadAPI("out/Button")

local function findArg(args, sa)
	for i,v in pairs(args) do
		if sa == "m=" and tostring(type(v)) == "table" then
			return v
		end
		local x,y = string.find(tostring(v),tostring(sa))
		if x and y then
			return string.sub(tostring(v),y+1)
		end
	end
	return nil
end

New = function(self,...) -- Creates and returns a new instance of "menu"
	local new = {}
	new.buttons = {}	
	setmetatable(new, {__index = self})
	new.name = findArg(arg, "n=") or "Menu"
	new.x = tonumber(findArg(arg, "x=")) or 5
	new.y = tonumber(findArg(arg, "y=")) or 5
	new.width = tonumber(findArg(arg, "w=")) or 10
	new.height = tonumber(findArg(arg, "h=")) or 5
	new.direction = findArg(arg, "d=") or "down"
	new.color_BG_ON = tonumber(findArg(arg, "cbg1=")) or colors.lightGray
	new.color_BG_DIS = tonumber(findArg(arg, "cbg3=")) or colors.gray
	new.color_TXT_ON = tonumber(findArg(arg, "ctx1=")) or colors.black
	new.color_TXT_DIS = tonumber(findArg(arg, "ctx3=")) or colors.white
	new.enabled = findArg(arg, "e=") or true
	new.state = false
	new.mon = findArg(arg, "m=") or term
	new.buttons.width = new.width
	
	return new
end

addPoint = function(self, name, func) -- Adds a Button to the menu
	local x, y
	if self.direction == "down" or self.direction == "up" then x = self.x elseif self.direction == "right" then x = self.x + 1 + (#self.buttons * self.width) elseif self.direction == "left" then x = self.x - 1 - (#self.buttons * self.width) end 
	if self.direction == "down" then y = self.y + 1 + #self.buttons elseif self.direction == "up" then y = self.y -1 - #self.buttons elseif self.direction == "right" or self.direction == "left" then y = self.y end 
	local tostring("Button_"..#self.buttons+1) = Button:New("n="..name,"cbg1=256","cbg2=256","cbg3=128","ctx1=32768","ctx2=32768","ctx3=1",self.mon,func,"x="..x,"y="..y)
	table.insert({tostring("Button_"..#self.buttons+1)})
end

local out = function(self) 
	if not self.state then
		for i=1,#self.buttons do
			--bla
		end
	end
end

wasPressed = function(self,x,y) -- Checks if the menu was pressed
	if x >= self.x and x <= (self.x + self.width ) and y >= self.y and y <= (self.y + self.height) then
		return true
	else
		return false
	end
end